{"version":3,"sources":["../../src/utilities/config.utilities.ts"],"sourcesContent":["import { Config } from '@oclif/core';\nimport fs from 'node:fs';\nimport fsp from 'node:fs/promises';\nimport path from 'node:path';\n\nimport { AppError, ERROR_TYPE } from '@condohub/common-utils';\n\n/**\n * Local user config file\n *\n * @example\n *  channel: latest\n    last_checked_at: 2022-04-20T13:53:28.083177-04:00\n    latest_release:\n      version: v0.0.320\n      prerelease: false\n      download_url: https://github.com/superfly/flyctl/releases/download/v0.0.320/flyctl_0.0.320_macOS_arm64.tar.gz\n      timestamp: 2022-04-13T16:04:48Z\n *\n */\nexport type UserConfig = {\n  accessToken?: string;\n};\n\nexport async function getUserConfig(config: Config) {\n  let userConfigExists = false;\n  try {\n    userConfigExists = fs.existsSync(path.join(config.configDir, 'config.json'));\n  } catch (error) {\n    throw new AppError({\n      name: ERROR_TYPE.CLI_ERROR,\n      message: 'Error occured when reading config.json',\n      stack: error instanceof Error ? error.stack : undefined,\n    });\n  }\n\n  return userConfigExists;\n}\n\nexport async function createUserConfig(config: Config, userConfig?: UserConfig) {\n  try {\n    const initialUserConfig: UserConfig = {\n      accessToken: '',\n    };\n    await fsp.mkdir(path.join(config.configDir), {\n      recursive: true,\n    });\n    await fsp.writeFile(\n      path.join(config.configDir, 'config.json'),\n      JSON.stringify(initialUserConfig, null, 2)\n    );\n    return initialUserConfig as UserConfig;\n  } catch (error) {\n    throw new AppError({\n      name: ERROR_TYPE.CLI_ERROR,\n      message: `Error occured while creating the initial user config.json: ${\n        error instanceof Error ? error.message : ''\n      }`,\n      stack: error instanceof Error ? error.stack : undefined,\n    });\n  }\n}\n\nexport async function updateUserConfig(config: Config, userConfig?: UserConfig) {\n  try {\n    const userConfigFile = await fsp.readFile(path.join(config.configDir, 'config.json'));\n    const currentUserConfig = JSON.parse(userConfigFile.toString());\n    const updatedUserConfig = { ...currentUserConfig, ...userConfig };\n    await fsp.writeFile(\n      path.join(config.configDir, 'config.json'),\n      JSON.stringify(updatedUserConfig, null, 2)\n    );\n    return currentUserConfig as UserConfig;\n  } catch (error) {\n    throw new AppError({\n      name: ERROR_TYPE.CLI_ERROR,\n      message: 'Error occured when updating config.json',\n      stack: error instanceof Error ? error.stack : undefined,\n    });\n  }\n}\n\nexport async function deleteUserConfig(config: Config) {\n  try {\n    await fsp.rm(path.join(config.configDir, 'config.json'));\n  } catch (error) {\n    throw new AppError({\n      name: ERROR_TYPE.CLI_ERROR,\n      message: 'Error occured when deleting config.json',\n      stack: error instanceof Error ? error.stack : undefined,\n    });\n  }\n}\n"],"names":["getUserConfig","createUserConfig","updateUserConfig","deleteUserConfig","config","userConfigExists","fs","existsSync","path","join","configDir","error","AppError","name","ERROR_TYPE","CLI_ERROR","message","stack","Error","undefined","userConfig","initialUserConfig","accessToken","fsp","mkdir","recursive","writeFile","JSON","stringify","userConfigFile","readFile","currentUserConfig","parse","toString","updatedUserConfig","rm"],"mappings":"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"}